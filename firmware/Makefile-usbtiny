# ======================================================================
# Makefile for xu1541
#
# Copyright (C) 2006 Till Harbaum
#
# This is free software, licensed under the terms of the GNU General
# Public License as published by the Free Software Foundation.
# ======================================================================

include ../bootloader/Makefile.common
LDFLAGS         = -Wl,$(COMMON_SECTIONS)

USBTINY         = ./usbtiny
TARGET_ARCH     = -DF_CPU=12000000 -DAVR -DUSBTINY -mmcu=atmega8
OBJECTS         = main.o xu1541.o s1.o s2.o pp.o p2.o event_log.o
CABLE           = stk200
AVRDUDE         = avrdude
FLASH_CMD       = $(AVRDUDE) -c $(CABLE) -p atmega8 -U lfuse:w:0x9f:m -U hfuse:w:0xc9:m -U flash:w:firmware-usbtiny.hex
STACK           = 32
FLASH       	= 8192
SRAM            = 1024

.INTERMEDIATE: crc.o int.o usb.o main.o xu1541.o s1.o s2.o pp.o p2.o event_log.o

include $(USBTINY)/common.mk

program-usb: firmware-usbtiny.hex
	avrdude -c usbasp -p atmega8 -U lfuse:w:0x9f:m -U hfuse:w:0xc9:m -U flash:w:firmware-usbtiny.hex

program-xu: firmware-usbtiny.hex
	../update_tool/xu1541_update firmware-usbtiny.hex
